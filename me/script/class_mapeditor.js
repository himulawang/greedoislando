var MapEditor = Coordinate.extend({
    init : function() {
        this._super();
        this.map = {
            "0,0":{
                "x":0,
                "y":0,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "0,6":{
                "x":0,
                "y":6,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "0,12":{
                "x":0,
                "y":12,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "0,18":{
                "x":0,
                "y":18,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "0,24":{
                "x":0,
                "y":24,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "0,30":{
                "x":0,
                "y":30,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "12,30":{
                "x":12,
                "y":30,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "18,30":{
                "x":18,
                "y":30,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "24,30":{
                "x":24,
                "y":30,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "30,30":{
                "x":30,
                "y":30,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "30,18":{
                "x":30,
                "y":18,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "30,12":{
                "x":30,
                "y":12,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "30,6":{
                "x":30,
                "y":6,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "30,0":{
                "x":30,
                "y":0,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "24,0":{
                "x":24,
                "y":0,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "18,0":{
                "x":18,
                "y":0,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "12,0":{
                "x":12,
                "y":0,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "6,0":{
                "x":6,
                "y":0,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "24,42":{
                "x":24,
                "y":42,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "30,42":{
                "x":30,
                "y":42,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "24,48":{
                "x":24,
                "y":48,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "24,54":{
                "x":24,
                "y":54,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "24,60":{
                "x":24,
                "y":60,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "30,60":{
                "x":30,
                "y":60,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "36,60":{
                "x":36,
                "y":60,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "48,60":{
                "x":48,
                "y":60,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "54,60":{
                "x":54,
                "y":60,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "60,60":{
                "x":60,
                "y":60,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "66,60":{
                "x":66,
                "y":60,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "66,54":{
                "x":66,
                "y":54,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "66,48":{
                "x":66,
                "y":48,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "36,42":{
                "x":36,
                "y":42,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "42,42":{
                "x":42,
                "y":42,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "54,42":{
                "x":54,
                "y":42,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "60,42":{
                "x":60,
                "y":42,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "66,42":{
                "x":66,
                "y":42,
                "objID":"2001",
                "l":"6",
                "w":"6"
            },
            "42,60":{
                "x":42,
                "y":60,
                "objID":"2003",
                "l":"6",
                "w":"6"
            },
            "48,42":{
                "x":48,
                "y":42,
                "objID":"2003",
                "l":"6",
                "w":"6"
            },
            "6,30":{
                "x":6,
                "y":30,
                "objID":"2003",
                "l":"6",
                "w":"6"
            },
            "30,24":{
                "x":30,
                "y":24,
                "objID":"2003",
                "l":"6",
                "w":"6"
            },
            "30,48":{
                "x":30,
                "y":48,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "30,54":{
                "x":30,
                "y":54,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "36,54":{
                "x":36,
                "y":54,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "36,48":{
                "x":36,
                "y":48,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "42,48":{
                "x":42,
                "y":48,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "48,48":{
                "x":48,
                "y":48,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "42,54":{
                "x":42,
                "y":54,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "48,54":{
                "x":48,
                "y":54,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "54,54":{
                "x":54,
                "y":54,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "54,48":{
                "x":54,
                "y":48,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "60,48":{
                "x":60,
                "y":48,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "60,54":{
                "x":60,
                "y":54,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "6,6":{
                "x":6,
                "y":6,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "6,12":{
                "x":6,
                "y":12,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "6,18":{
                "x":6,
                "y":18,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "6,24":{
                "x":6,
                "y":24,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "12,24":{
                "x":12,
                "y":24,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "18,24":{
                "x":18,
                "y":24,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "24,24":{
                "x":24,
                "y":24,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "12,18":{
                "x":12,
                "y":18,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "12,12":{
                "x":12,
                "y":12,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "12,6":{
                "x":12,
                "y":6,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "18,6":{
                "x":18,
                "y":6,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "18,12":{
                "x":18,
                "y":12,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "18,18":{
                "x":18,
                "y":18,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "24,18":{
                "x":24,
                "y":18,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "24,12":{
                "x":24,
                "y":12,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "24,6":{
                "x":24,
                "y":6,
                "objID":"2005",
                "l":"6",
                "w":"6"
            },
            "36,66":{
                "x":36,
                "y":66,
                "objID":"2004",
                "l":"6",
                "w":"6"
            },
            "36,72":{
                "x":36,
                "y":72,
                "objID":"2004",
                "l":"6",
                "w":"6"
            },
            "36,78":{
                "x":36,
                "y":78,
                "objID":"2004",
                "l":"6",
                "w":"6"
            },
            "36,84":{
                "x":36,
                "y":84,
                "objID":"2004",
                "l":"6",
                "w":"6"
            },
            "36,90":{
                "x":36,
                "y":90,
                "objID":"2004",
                "l":"6",
                "w":"6"
            },
            "72,42":{
                "x":72,
                "y":42,
                "objID":"2004",
                "l":"6",
                "w":"6"
            },
            "84,42":{
                "x":84,
                "y":42,
                "objID":"2004",
                "l":"6",
                "w":"6"
            },
            "90,42":{
                "x":90,
                "y":42,
                "objID":"2004",
                "l":"6",
                "w":"6"
            },
            "78,42":{
                "x":78,
                "y":42,
                "objID":"2006",
                "l":"6",
                "w":"6"
            },
            "0,42":{
                "x":0,
                "y":42,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "0,48":{
                "x":0,
                "y":48,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "6,42":{
                "x":6,
                "y":42,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "6,72":{
                "x":6,
                "y":72,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "6,78":{
                "x":6,
                "y":78,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "12,78":{
                "x":12,
                "y":78,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "12,84":{
                "x":12,
                "y":84,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "48,84":{
                "x":48,
                "y":84,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "54,90":{
                "x":54,
                "y":90,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "66,72":{
                "x":66,
                "y":72,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "72,72":{
                "x":72,
                "y":72,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "78,66":{
                "x":78,
                "y":66,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "78,60":{
                "x":78,
                "y":60,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "72,84":{
                "x":72,
                "y":84,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "78,84":{
                "x":78,
                "y":84,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "84,78":{
                "x":84,
                "y":78,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "36,18":{
                "x":36,
                "y":18,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "42,30":{
                "x":42,
                "y":30,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "48,6":{
                "x":48,
                "y":6,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "54,6":{
                "x":54,
                "y":6,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "66,0":{
                "x":66,
                "y":0,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "60,12":{
                "x":60,
                "y":12,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "54,18":{
                "x":54,
                "y":18,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "60,18":{
                "x":60,
                "y":18,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "78,12":{
                "x":78,
                "y":12,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "78,18":{
                "x":78,
                "y":18,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "84,18":{
                "x":84,
                "y":18,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "84,12":{
                "x":84,
                "y":12,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "66,36":{
                "x":66,
                "y":36,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "72,36":{
                "x":72,
                "y":36,
                "objID":"2002",
                "l":"6",
                "w":"6"
            },
            "72,30":{
                "x":72,
                "y":30,
                "objID":"2002",
                "l":"6",
                "w":"6"
            }
        };
        this.DEFINE = {
            2000 : {
                name : 'Plain'
                ,abbreviation : 'P'
                ,movePossible : 1
            }
            ,2001 : {
                name : 'Broken Wall'
                ,abbreviation : 'W'
                ,movePossible : 0
            }
            ,2002 : {
                name : 'Tree'
                ,abbreviation : 'T'
                ,movePossible : 0
            }
            ,2003 : {
                name : 'Door'
                ,abbreviation : 'D'
                ,movePossible : 1
            }
            ,2004 : {
                name : 'River'
                ,abbreviation : 'R'
                ,movePossible : 0
            }
            ,2005 : {
                name : 'Ruins'
                ,abbreviation : 'U'
                ,movePossible : 1
            }
            ,2006 : {
                name : 'Bridge'
                ,abbreviation : 'B'
                ,movePossible : 1
            }
        }
        this.getCanvas($('#grid')[0]);
        this.draw();
        this.terrainType = "2000";
    }
    ,getCanvas : function(el) {
        el.width = this.MAPWIDTH;
        el.height = this.MAPHEIGHT;
        this.context = el.getContext('2d');
    }
    ,click : function(x, y) {
        var i, j, index;
        var l, w;
        l = $("#l").val();
        w = $("#w").val();
        //var type = $(".terrain:checked").val();
        var type = this.terrainType;
        index = this.getCoordinateIndex(x, y);
        if (type === 'del') {
            delete this.map[index];
        }else {
            this.map[index] = {
                x : x
                ,y : y
                ,objID : type
                ,l : l
                ,w : w
            }
        }
        $('#console').html(JSON.stringify(this.map));
        this.draw();
    }
    ,draw : function() {
        var x, y;
        this.context.clearRect(0, 0, this.MAPWIDTH, this.MAPHEIGHT);
        this.context.beginPath();
        this.context.moveTo(this.MAPWIDTH / 2, 0);
        this.context.lineTo(0, this.MAPHEIGHT / 2);
        this.context.lineTo(this.MAPWIDTH / 2, this.MAPHEIGHT);
        this.context.lineTo(this.MAPWIDTH, this.MAPHEIGHT / 2);
        this.context.closePath();
        this.context.stroke();

        //draw line
        for (var i = 1; i < this.GRIDQUANTITY; ++i) {
            if (i % 6 === 0) {
                // 0 , 1
                x = 0; y = i;
                this.context.beginPath();
                this.context.moveTo(this.transferLogicToScreenX(x, y), this.transferLogicToScreenY(x, y));
                // 16, 1
                x = this.GRIDQUANTITY; y = i;
                this.context.lineTo(this.transferLogicToScreenX(x, y), this.transferLogicToScreenY(x, y));
                this.context.closePath();
                this.context.stroke();
            }
        }

        for (var i = 1; i < this.GRIDQUANTITY; ++i) {
            if (i % 6 === 0) {
                // 1 , 0
                x = i; y = 0;
                this.context.beginPath();
                this.context.moveTo(this.transferLogicToScreenX(x, y), this.transferLogicToScreenY(x, y));
                // 1, 16
                x = i; y = this.GRIDQUANTITY;
                this.context.lineTo(this.transferLogicToScreenX(x, y), this.transferLogicToScreenY(x, y));
                this.context.closePath();
                this.context.stroke();
            }
        }

        //draw text
        var terrainType, coordinate, xy, tmpXY;
        for (var index in this.map) {
            tmpXY = this.getCoordinateXY(index);
            x = tmpXY.x;
            y = tmpXY.y;
            index = this.getCoordinateIndex(x, y);

            terrainType = this.getTerrainAbbreviation(index);
            coordinate = index;

            this.context.fillStyle = '#000000';
            this.context.font = 'Calibri 3px sans-serif';
            this.context.textBaseline = 'top';
            this.context.fillText(terrainType, this.transferLogicToScreenX(x, y) - 3, this.transferLogicToScreenY(x, y) - 2);
        }
    }
    ,getTerrainAbbreviation : function(index) {
        if (!this.map[index]) return false;
        var objID = this.map[index].objID;
        
        return this.DEFINE[objID].abbreviation;
    }
});
